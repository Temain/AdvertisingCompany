<!-- ko with: clientsList -->
<ol class="breadcrumb">
    <li>ВЫ ЗДЕСЬ</li>
    <li class="active">Клиенты</li>
</ol>
<h1 class="page-title">Клиенты рекламной компании</h1>
<div class="mrgbtm24">
    <a href="/admin/#clients/create" class="btn btn-warning"><i class="fa fa-plus" aria-hidden="true"></i>&nbsp;Добавить клиента</a>
</div>
<section class="widget">
    <header>
        @*<h4>
                Клиенты рекламной компании
            </h4>
            <div class="widget-controls">
                <a data-widgster="expand" title="Expand" href="#"><i class="glyphicon glyphicon-chevron-up"></i></a>
                <a data-widgster="collapse" title="Collapse" href="#"><i class="glyphicon glyphicon-chevron-down"></i></a>
                <a data-widgster="close" title="Close" href="#"><i class="glyphicon glyphicon-remove"></i></a>
            </div>*@
        <div id="progress" class="row" style="display: none">
            <div class="col-md-4 col-md-offset-4">
                <div class="progress">
                    <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
                        <span class="sr-only">100% Complete</span>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <div class="widget-body">
        <div class="dataTables_wrapper form-inline no-footer">
        <div class="row">
            <div class="col-md-6 hidden-xs">
                <div class="dataTables_length" id="datatable-table_length">
                    <label>
                        Показать
                        <select id="pageSize" class="form-control" title="" data-size="10" data-bind="selectPicker: pageSize, selectPickerOptions : { optionsArray : pageSizes, width: '70px' }, event : { change: pageSizeChanged }"></select>
                        записей
                    </label>
                </div>
            </div>
            <div class="col-md-6">
                <div id="datatable-table_filter" class="pull-right">
                    <label>Поиск:<input type="search" class="form-control input-rounded ml-sm" data-bind="value: searchQuery, valueUpdate: 'afterkeydown', event:{keyup:search}"></label>
                </div>
            </div>
        </div>
        <table id="datatable-table" class="table table-striped table-hover">
            <thead>
            <tr>
                <th>#</th>
                <th class="col-md-3">Компания</th>
                <th class="col-md-2 hidden-xs">Деятельность</th>
                <th class="col-md-1 hidden-xs">Ответственный</th>
                <th class="col-md-1 no-sort hidden-xs">Телефоны</th>
                <th class="col-md-1 no-sort hidden-xs">Email</th>
                <th class="col-md-1">Логин</th>
                <th class="col-md-1 hidden-xs">Добавлен</th>
                <th class="col-md-1">Статус</th>
                <th class="col-md-1 no-sort">Редактирование</th>
            </tr>
            </thead>
            <tbody data-bind="foreach: clients">
            <tr>
                <td data-bind="text: ((($parent.page() - 1) * $parent.pageSize()) + $index() + 1) + '.'"></td>
                <td><span class="fw-semi-bold" data-bind="text: companyName"></span></td>
                <td class="hidden-xs" data-bind="text: activityTypeName"></td>
                <td class="hidden-xs" data-bind="text: responsiblePersonShortName"></td>
                <td class="hidden-xs">
                    <span data-bind="text: phoneNumber"></span><br/>
                    <span data-bind="text: additionalPhoneNumber"></span>
                </td>
                <td class="hidden-xs" data-bind="text: email"></td>
                <td data-bind="foreach: userNames">
                    <span data-bind="text: $data"></span>
                </td>
                <td class="hidden-xs" data-bind="text: createdAt"></td>
                <td><span class="label label-success" data-bind="text: clientStatusName"></span></td>
                <td class="actions">
                    <a href="#">
                        <span class="fa-stack">
                            <i class="fa fa-circle fa-stack-2x"></i>
                            <i class="fa fa-flag fa-stack-1x fa-inverse"></i>
                        </span>
                    </a>
                    <a href="#">
                        <span class="fa-stack">
                            <i class="fa fa-circle fa-stack-2x"></i>
                            <i class="fa fa-pencil fa-stack-1x fa-inverse"></i>
                        </span>
                    </a>
                    <a href="#">
                        <span class="fa-stack">
                            <i class="fa fa-circle fa-stack-2x"></i>
                            <i class="fa fa-times fa-stack-1x fa-inverse"></i>
                        </span>
                    </a>
                </td>
            </tr>
            </tbody>
        </table>

        <!-- ko if: clients().length > 0 -->
        <div class="row">
            <div class="col-md-6">
                <div class="dataTables_info" data-bind="text: 'Записи с ' + (((page() - 1) * pageSize()) + 1) + ' до ' + (((page() - 1) * pageSize()) + clients().length) + ' из ' + ((pagesCount() - 1) * pageSize() + clients().length) + ' записей'"></div>
            </div>
            <div class="col-md-6">
                <!-- ko if: pagesCount() > 1 -->
                <div class="dataTables_paginate paging_bootstrap">
                    <ul class="pagination no-margin">
                        <li class="prev disabled">
                            <a href="#" aria-label="Previous">
                                @*<span aria-hidden="true">&laquo;</span>*@
                                Предыдущая
                            </a>
                        </li>

                        <!-- ko foreach: new Array(pagesCount()) -->
                        <!-- ko if: $index() >= $parent.page() - 4 && $index() <= $parent.page() + 2 -->
                        <li data-bind="attr: { 'class' : $parent.page() == ($index() + 1) ? 'active' : '' }">
                            <a href="#" data-bind="text: $index() + 1, click: function () { $parent.pageChanged($index() + 1); }"></a>
                        </li>
                        <!-- /ko -->
                        <!-- /ko -->

                        <li class="next">
                            <a href="#" aria-label="Next">
                                @*<span aria-hidden="true">&raquo;</span>*@
                                Следующая
                            </a>
                        </li>
                    </ul>
                </div>
                <!-- /ko -->
            </div>
        </div>
        <!-- /ko -->
        </div>
    </div>
</section>
<!-- /ko -->

@*@section Scripts {
    @Scripts.Render("~/bundles/knockout")
    <script src="~/Scripts/progress.js"></script>

    <script>
        function MainViewModel() {
            var self = this;

            self.Clients = ko.observableArray([]);
            self.SelectedPage = ko.observable(1);
            self.PagesCount = ko.observable('');
            

            self.loadClients = function () {
                Progress.Show();
                $.post('/Admin/Client/Get', {
                    page: self.SelectedPage(),
                    pageSize: self.SelectedPageSize()
                }, function (response) {
                    ko.mapping.fromJS(response.Clients,
                        {
                            key: function (data) {
                                return ko.utils.unwrapObservable(data.UserId);
                            },
                            create: function (options) {
                                return new ClientViewModel(options.data);
                            }
                        },
                        self.Clients
                    );
                    self.PagesCount(response.PagesCount);
                    Progress.Hide();
                });
            };

            self.selectedPageChanged = function (page) {
                self.SelectedPage(page);
                self.loadClients();

                window.scrollTo(0, 0);
            };

            self.pageSizeChanged = function () {
                self.SelectedPage(1);
                self.loadClients();

                window.scrollTo(0, 0);
            };

            self.clearFilter = function () {
                self.SelectedPage(1);
                self.ClientId('');

                self.loadClients();
            };
        }

        // Bindings
        ko.bindingHandlers.tooltip = {
            init: function (element, valueAccessor) {
                var local = ko.utils.unwrapObservable(valueAccessor()),
                    options = {};

                ko.utils.extend(options, ko.bindingHandlers.tooltip.options);
                ko.utils.extend(options, local);

                $(element).tooltip(options);

                ko.utils.domNodeDisposal.addDisposeCallback(element, function () {
                    $(element).tooltip("destroy");
                });
            },
            options: {
                placement: "top",
                trigger: "click"
            }
        };

        function ClientViewModel(clientViewModel) {
            var self = this;
            self.UserId = ko.observable(clientViewModel.UserId || '');
            self.FullName = ko.observable(clientViewModel.FullName || '');
            self.Login = ko.observable(clientViewModel.Login || '');
            self.CreatedAt = ko.observable(clientViewModel.CreatedAt || '');
        }

        var viewModel = new MainViewModel();
        $(function () {
            ko.applyBindings(viewModel);
            viewModel.loadClients();

            $('[data-toggle="tooltip"]').tooltip();
        });
    </script>
}*@